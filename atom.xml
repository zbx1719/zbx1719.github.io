<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
    <id>https://zbx1719.github.io</id>
    <title>æ‚è®°</title>
    <updated>2019-05-26T09:22:26.727Z</updated>
    <generator>https://github.com/jpmonette/feed</generator>
    <link rel="alternate" href="https://zbx1719.github.io"/>
    <link rel="self" href="https://zbx1719.github.io/atom.xml"/>
    <subtitle>æ¸©æ•…è€ŒçŸ¥æ–°</subtitle>
    <logo>https://zbx1719.github.io/images/avatar.png</logo>
    <icon>https://zbx1719.github.io/favicon.ico</icon>
    <rights>All rights reserved 2019, æ‚è®°</rights>
    <entry>
        <title type="html"><![CDATA[ç”¨Grideaå’ŒGithubæ­å»ºåšå®¢]]></title>
        <id>https://zbx1719.github.io/post/XtmeIMFpH</id>
        <link href="https://zbx1719.github.io/post/XtmeIMFpH">
        </link>
        <updated>2019-05-26T09:11:53.000Z</updated>
        <summary type="html"><![CDATA[<p>ç›®å‰ä¸»æµçš„åšå®¢æ¡†æ¶æœ‰Hexoå’ŒWordpressï¼Œä½¿ç”¨è¿™äº›åšå®¢æ¡†æ¶å¯ä»¥è‡ªè¡Œæ­å»ºä¸€ä¸ªåšå®¢ã€‚ä½†æ˜¯è¿™æ ·æœ‰ä¸€å®šç¼ºç‚¹ã€‚Wordpresséœ€è¦ç§Ÿç”¨ä¸€å°vpsï¼Œåªç”¨äºæ­åšå®¢è€Œä¸”æ›´æ–°ä¸é¢‘ç¹çš„è¯æ€§ä»·æ¯”å¾ˆä½ã€‚Hexoå¯ä»¥ä½¿ç”¨GitHubå…è´¹æä¾›çš„GitHub pageæ­å»ºåšå®¢ï¼Œä½†æ˜¯æ›´æ–°åšå®¢æ¯”è¾ƒéº»çƒ¦ã€‚ç›´åˆ°æˆ‘å‘ç°äº†Gridea</p>
]]></summary>
        <content type="html"><![CDATA[<p>ç›®å‰ä¸»æµçš„åšå®¢æ¡†æ¶æœ‰Hexoå’ŒWordpressï¼Œä½¿ç”¨è¿™äº›åšå®¢æ¡†æ¶å¯ä»¥è‡ªè¡Œæ­å»ºä¸€ä¸ªåšå®¢ã€‚ä½†æ˜¯è¿™æ ·æœ‰ä¸€å®šç¼ºç‚¹ã€‚Wordpresséœ€è¦ç§Ÿç”¨ä¸€å°vpsï¼Œåªç”¨äºæ­åšå®¢è€Œä¸”æ›´æ–°ä¸é¢‘ç¹çš„è¯æ€§ä»·æ¯”å¾ˆä½ã€‚Hexoå¯ä»¥ä½¿ç”¨GitHubå…è´¹æä¾›çš„GitHub pageæ­å»ºåšå®¢ï¼Œä½†æ˜¯æ›´æ–°åšå®¢æ¯”è¾ƒéº»çƒ¦ã€‚ç›´åˆ°æˆ‘å‘ç°äº†Gridea</p>
<!-- more -->
<h2 id="grideaç®€ä»‹">Grideaç®€ä»‹</h2>
<p><a href="https://gridea.dev">Gridea</a>æ˜¯ä¸€ä¸ªè·¨å¹³å°çš„å¼€æºåšå®¢å†™ä½œè½¯ä»¶ï¼Œæ”¯æŒMacï¼ŒWindowså’ŒLinuxã€‚ä½¿ç”¨Grideaå¯ä»¥å¾ˆè½»æ¾çš„å†™ä½œã€ç®¡ç†å’Œæ¨é€åšå®¢åˆ°GitHub Pageä¸Šã€‚å¦‚æœä¹‹å‰ç”¨è¿‡Hexoçš„è¯ä¼šå‘ç°Grideaå¾ˆå®¹æ˜“ä¸Šæ‰‹ã€‚</p>
<h2 id="grideaé…ç½®">Grideaé…ç½®</h2>
<p>Grideaä¸‹è½½åæ˜¯å¦‚ä¸‹ç•Œé¢
<img src="https://raw.githubusercontent.com/getgridea/gridea/develop/gridea-app.png" alt="">
ç‚¹å‡»é…ç½®ï¼Œå°†è‡ªå·±çš„GitHub pageä¿¡æ¯å¡«å…¥
<img src="https://zbx1719.github.io/post-images/1558862427449.png" alt="">
GitHub pageåˆ›å»ºå¯ä»¥å‚è€ƒè¿™ç¯‡æ–‡ç« <a href="https://zhuanlan.zhihu.com/p/23761258">åˆ©ç”¨Github Page æ­å»ºä¸ªäººåšå®¢ç½‘ç«™</a>
å¡«å†™å®Œæˆåç‚¹å‡»ä¿å­˜å³å¯
æ–‡ç« å†™å®Œåç‚¹å‡»é¢„è§ˆå¯ä»¥æŸ¥çœ‹æ•ˆæœ
<img src="https://zbx1719.github.io/post-images/1558862171926.png" alt=""></p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Springè§£å†³staticæ–¹æ³•æ³¨å…¥mapperé—®é¢˜]]></title>
        <id>https://zbx1719.github.io/post/ZP_pBgDQB</id>
        <link href="https://zbx1719.github.io/post/ZP_pBgDQB">
        </link>
        <updated>2019-05-26T07:50:57.000Z</updated>
        <summary type="html"><![CDATA[<p>å¼€å‘ä¸­é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œéœ€è¦åœ¨å·¥ç¨‹å¯åŠ¨æ—¶ä½¿ç”¨ä¸€ä¸ªé™æ€æ–¹æ³•è°ƒç”¨mapperä»æ•°æ®åº“åŠ è½½æ•°æ®åšåˆå§‹åŒ–ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>å¼€å‘ä¸­é‡åˆ°ä¸€ä¸ªé—®é¢˜ï¼Œéœ€è¦åœ¨å·¥ç¨‹å¯åŠ¨æ—¶ä½¿ç”¨ä¸€ä¸ªé™æ€æ–¹æ³•è°ƒç”¨mapperä»æ•°æ®åº“åŠ è½½æ•°æ®åšåˆå§‹åŒ–ã€‚</p>
<!-- more -->
<pre><code>@Autowired
public CacheMapper cacheMapper;
</code></pre>
<p>ä½†æ˜¯ä¼šå‘ç°mapperæ³¨å…¥å¤±è´¥ï¼ŒcacheMapperä¸ºnullã€‚è¿™æ˜¯å› ä¸ºé™æ€å˜é‡/ç±»å˜é‡ä¸æ˜¯å¯¹è±¡çš„å±æ€§,è€Œæ˜¯ä¸€ä¸ªç±»çš„å±æ€§,springåˆ™æ˜¯åŸºäºå¯¹è±¡å±‚é¢ä¸Šçš„ä¾èµ–æ³¨å…¥ã€‚
å› æ­¤ï¼Œæˆ‘ä»¬è¦é€šè¿‡ä»¥ä¸‹çš„æ–¹æ³•ï¼ŒæŠŠcacheMapperå˜æˆä¸€ä¸ªé™æ€å˜é‡ï¼Œè®©staticæ–¹æ³•å¯ä»¥è°ƒç”¨ã€‚</p>
<pre><code>@Component
public class SQLiteHelper {

    @Autowired
    public CacheMapper tmpCacheMapper;

    private static CacheMapper cacheMapper;


    @PostConstruct
    public  void init(){
        cacheMapper=tmpCacheMapper;
        cacheMapper.init();
 
        }
    }
   }

</code></pre>
<p>é¦–å…ˆåœ¨classä¸ŠåŠ ä¸Š@Componentæ³¨è§£ä½¿è¯¥classèƒ½è¢«ä½œä¸ºbeanåŠ è½½</p>
<p>ç„¶åå®ç°ä¸€ä¸ªè¢«@PostConstructæ³¨è§£ä¿®é¥°çš„initæ–¹æ³•ã€‚@PostConstructçš„ä½œç”¨æ˜¯è®©init()æ–¹æ³•åœ¨æ„é€ å‡½æ•°æ‰§è¡Œå®Œæˆåç«‹å³æ‰§è¡Œã€‚æ‰§è¡Œinit()æ–¹æ³•ä¼šå®ä¾‹åŒ–ä¸€ä¸ªCacheMapperå¯¹è±¡tmpCacheMapperï¼Œå¹¶æŠŠè¿™ä¸ªå¯¹è±¡èµ‹å€¼ç»™é™æ€å˜é‡cacheMapperã€‚æ­¤æ—¶ï¼ŒcacheMapperå°±å¯ä»¥è¢«staticæ–¹æ³•è°ƒç”¨äº†ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ç”¨SQLiteåšç¼“å­˜çš„æœ¬åœ°æŒä¹…åŒ–]]></title>
        <id>https://zbx1719.github.io/post/JMbGBc2io</id>
        <link href="https://zbx1719.github.io/post/JMbGBc2io">
        </link>
        <updated>2019-05-26T07:48:32.000Z</updated>
        <summary type="html"><![CDATA[<p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦å°†ç¼“å­˜ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°ç¡¬ç›˜ä¸­ï¼Œä»¥é˜²æœåŠ¡å´©æºƒé‡å¯åç¼“å­˜ä¸­æ•°æ®ä¸¢å¤±ã€‚æˆ–è€…æ˜¯æŸ¥è¯¢ä¸€æ¬¡æ•°æ®åº“æˆæœ¬è¾ƒé«˜ï¼Œéœ€è¦å°†æŸ¥è¯¢å›æ¥çš„ç»“æœå­˜åˆ°æœ¬åœ°ä»¥å¤šæ¬¡ä½¿ç”¨ã€‚è¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªæœ¬åœ°ç¼“å­˜æ¥å­˜å‚¨è¿™ä¸€éƒ¨åˆ†æ•°æ®ã€‚</p>
<p>SQLiteä½œä¸ºä¸€ä¸ªè½»é‡çº§æ•°æ®åº“å¯ä»¥å¾ˆè½»æ˜“æ»¡è¶³è¿™ä¸€éœ€æ±‚ï¼Œå¯ä»¥åœ¨å¤§éƒ¨åˆ†çš„åœºæ™¯ä¸‹ä½¿ç”¨ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>æœ‰æ—¶å€™æˆ‘ä»¬éœ€è¦å°†ç¼“å­˜ä¸­çš„æ•°æ®æŒä¹…åŒ–åˆ°ç¡¬ç›˜ä¸­ï¼Œä»¥é˜²æœåŠ¡å´©æºƒé‡å¯åç¼“å­˜ä¸­æ•°æ®ä¸¢å¤±ã€‚æˆ–è€…æ˜¯æŸ¥è¯¢ä¸€æ¬¡æ•°æ®åº“æˆæœ¬è¾ƒé«˜ï¼Œéœ€è¦å°†æŸ¥è¯¢å›æ¥çš„ç»“æœå­˜åˆ°æœ¬åœ°ä»¥å¤šæ¬¡ä½¿ç”¨ã€‚è¿™æ—¶å€™æˆ‘ä»¬å°±éœ€è¦ä¸€ä¸ªæœ¬åœ°ç¼“å­˜æ¥å­˜å‚¨è¿™ä¸€éƒ¨åˆ†æ•°æ®ã€‚</p>
<p>SQLiteä½œä¸ºä¸€ä¸ªè½»é‡çº§æ•°æ®åº“å¯ä»¥å¾ˆè½»æ˜“æ»¡è¶³è¿™ä¸€éœ€æ±‚ï¼Œå¯ä»¥åœ¨å¤§éƒ¨åˆ†çš„åœºæ™¯ä¸‹ä½¿ç”¨ã€‚</p>
<!-- more -->
<h2 id="sqliteé…ç½®mybatis">SQLiteé…ç½®ï¼ˆMybatisï¼‰</h2>
<p>å› ä¸ºSQLiteæœ¬èº«å°±æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ•°æ®åº“ï¼Œå› æ­¤æˆ‘ä»¬åªéœ€è¦æŒ‰ç…§é…ç½®æ•°æ®åº“çš„æ–¹å¼å¯¹å®ƒé…ç½®å°±è¡Œäº†ã€‚è¿™é‡Œä»¥mybatisä¸ºä¾‹</p>
<h3 id="xmlé…ç½®">xmlé…ç½®</h3>
<p>åœ¨springçš„xmlé…ç½®æ–‡ä»¶ä¸­åŠ å…¥ä¸‹é¢å‡ ä¸ªbeanï¼Œå…¶ä¸­urlçš„valueä¸º<code>jdbc:sqlite:SQLiteæ•°æ®åº“æ–‡ä»¶çš„ç»å¯¹è·¯å¾„</code></p>
<pre><code>&lt;bean id=&quot;dataSource&quot; class=&quot;org.apache.commons.dbcp.BasicDataSource&quot; destroy-method=&quot;close&quot;&gt;
    &lt;property name=&quot;driverClassName&quot; value=&quot;org.sqlite.JDBC&quot; /&gt;
    &lt;property name=&quot;url&quot; value=&quot;jdbc:sqlite:/opt/applog/MskyLog/UmeInfoClientCache.db&quot; /&gt;
    &lt;!-- åˆå§‹åŒ–è¿æ¥å¤§å° --&gt;
    &lt;property name=&quot;initialSize&quot; value=&quot;10&quot; /&gt;
    &lt;!-- è¿æ¥æ± æœ€å¤§æ•°é‡ --&gt;
    &lt;property name=&quot;maxActive&quot; value=&quot;10&quot; /&gt;
    &lt;!-- è¿æ¥æ± æœ€å¤§ç©ºé—² --&gt;
    &lt;property name=&quot;maxIdle&quot; value=&quot;10&quot; /&gt;
    &lt;!-- è¿æ¥æ± æœ€å°ç©ºé—² --&gt;
    &lt;property name=&quot;minIdle&quot; value=&quot;1&quot; /&gt;
    &lt;!-- è·å–è¿æ¥æœ€å¤§ç­‰å¾…æ—¶é—´ --&gt;
    &lt;property name=&quot;maxWait&quot; value=&quot;3600&quot; /&gt;
&lt;/bean&gt;


&lt;!-- springå’ŒMyBatiså®Œç¾æ•´åˆï¼Œä¸éœ€è¦mybatisçš„é…ç½®æ˜ å°„æ–‡ä»¶ --&gt;
&lt;bean id=&quot;sqlSessionFactory&quot; class=&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;
    &lt;!-- è‡ªåŠ¨æ‰«æmapping.xmlæ–‡ä»¶ï¼Œ**è¡¨ç¤ºè¿­ä»£æŸ¥æ‰¾ --&gt;
    &lt;property name=&quot;mapperLocations&quot; value=&quot;classpath:sqlmap/*Mapper.xml&quot; /&gt;
&lt;/bean&gt;

&lt;!-- DAOæ¥å£æ‰€åœ¨åŒ…åï¼ŒSpringä¼šè‡ªåŠ¨æŸ¥æ‰¾å…¶ä¸‹çš„ç±» ,åŒ…ä¸‹çš„ç±»éœ€è¦ä½¿ç”¨@MapperScanæ³¨è§£,å¦åˆ™å®¹å™¨æ³¨å…¥ä¼šå¤±è´¥ --&gt;
&lt;bean class=&quot;org.mybatis.spring.mapper.MapperScannerConfigurer&quot;&gt;
    &lt;property name=&quot;basePackage&quot; value=&quot;com.umetrip.infoclient.dao&quot; /&gt;
    &lt;property name=&quot;sqlSessionFactoryBeanName&quot; value=&quot;sqlSessionFactory&quot; /&gt;
&lt;/bean&gt;

&lt;!-- (äº‹åŠ¡ç®¡ç†)transaction manager, use JtaTransactionManager for global tx --&gt;
&lt;bean id=&quot;transactionManager&quot; class=&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;&gt;
    &lt;property name=&quot;dataSource&quot; ref=&quot;dataSource&quot; /&gt;
&lt;/bean&gt;
</code></pre>
<h3 id="mapperç±»å’Œxml">Mapperç±»å’Œxml</h3>
<p>è¿™éƒ¨åˆ†å°±æ˜¯mybatisçš„é…ç½®ï¼Œæ–°å»ºä¸€ä¸ªæ¥å£ç±»</p>
<pre><code>@MapperScan
public interface CacheMapper {

     boolean replace(EhCachePersistenceBean bean);

     List&lt;EhCachePersistenceBean&gt; getAll();

     void init();

}
</code></pre>
<p>ç„¶ååœ¨å¯¹åº”çš„xmlä¸­åŠ å…¥æ¥å£å¯¹åº”çš„sql</p>
<pre><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;
&lt;!DOCTYPE mapper
        PUBLIC &quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;
        &quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;&gt;

&lt;!--ehcacheæ•°æ®æŒä¹…åŒ–ä¸“ç”¨--&gt;

&lt;mapper namespace=&quot;com.umetrip.infoclient.dao.CacheMapper&quot;&gt;
    &lt;resultMap id=&quot;CacheMap&quot; type=&quot;com.umetrip.infocenter.entity.EhCachePersistenceBean&quot;&gt;
        &lt;result column=&quot;cacheName&quot; jdbcType=&quot;VARCHAR&quot;/&gt;
        &lt;result column=&quot;primaryKey&quot; jdbcType=&quot;VARCHAR&quot;/&gt;
        &lt;result column=&quot;cacheValue&quot; jdbcType=&quot;VARCHAR&quot;/&gt;
    &lt;/resultMap&gt;

    &lt;insert id=&quot;replace&quot; parameterType=&quot;com.umetrip.infocenter.entity.EhCachePersistenceBean&quot;&gt;
        REPLACE INTO EHCACHE_PERSISTENCE
        (CACHENAME,PRIMARYKEY,CACHEVALUE)
        VALUES
        (#{cacheName},#{primaryKey},#{cacheValue})
    &lt;/insert&gt;

    &lt;select id=&quot;getAll&quot; resultMap=&quot;CacheMap&quot;&gt;
       SELECT
       CHACHENAME,PRIMARYKEY,CACHEVALUE
       FROM
       EHCACHE_PERSISTENCE
    &lt;/select&gt;

    &lt;update id=&quot;init&quot;&gt;
        CREATE TABLE IF NOT EXISTS EHCACHE_PERSISTENCE(
          CACHENAME VARCHAR(100),
          PRIMARYKEY VARCHAR(50),
          CACHEVALUE TEXT,
          constraint EHCACHE_PERSISTENCE_pk
              primary key (CACHENAME, PRIMARYKEY)
         );

    &lt;/update&gt;

&lt;/mapper&gt;
</code></pre>
<p>å·¥ç¨‹å¯åŠ¨æ—¶è¦è°ƒç”¨å»ºè¡¨çš„æ–¹æ³•ï¼Œé˜²æ­¢æ–°èŠ‚ç‚¹æ²¡æœ‰å¯¹åº”çš„æ•°æ®åº“æ–‡ä»¶ã€‚
æˆ‘ä»¬å¯ä»¥æµ‹è¯•ä¸€ä¸‹</p>
<pre><code>@RunWith(SpringJUnit4ClassRunner.class)
@ContextConfiguration(value = &quot;classpath:applicationContext-infoclient.xml&quot;)
public class TestMapper {

    @Autowired
    private CacheMapper cacheMapper;

    @Test
    public void testInit(){
        cacheMapper.init();
    }
}
</code></pre>
<p>æ‰§è¡Œå®ŒtestInit()æ–¹æ³•åå¯ä»¥çœ‹åˆ°UmeInfoClientCache.dbå·²ç»åœ¨/opt/applog/MskyLog/è·¯å¾„ä¸‹å­˜åœ¨äº†ï¼Œç”¨å®¢æˆ·ç«¯æ‰“å¼€dbæ–‡ä»¶å¯ä»¥çœ‹åˆ°ç›¸åº”çš„è¡¨ç»“æ„</p>
<p>ä»¥ä¸Šå°±æ˜¯SQLiteç®€å•çš„ä½¿ç”¨æ–¹æ³•ã€‚</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Databus Mysqlä¿å­˜MaxScnçš„ç®—æ³•]]></title>
        <id>https://zbx1719.github.io/post/qe9tUw9-p</id>
        <link href="https://zbx1719.github.io/post/qe9tUw9-p">
        </link>
        <updated>2019-05-26T07:37:44.000Z</updated>
        <summary type="html"><![CDATA[<p>databus oracleä¿å­˜scné‡‡ç”¨oracleåŸç”Ÿçš„scnå·ï¼ŒMysqlçš„scnæ˜¯é€šè¿‡ç®—æ³•è®¡ç®—å‡ºæ¥çš„ã€‚MaxScnæ˜¯ä¸€ä¸ª64ä½çš„longå‹æ•°æ®ã€‚</p>
]]></summary>
        <content type="html"><![CDATA[<p>databus oracleä¿å­˜scné‡‡ç”¨oracleåŸç”Ÿçš„scnå·ï¼ŒMysqlçš„scnæ˜¯é€šè¿‡ç®—æ³•è®¡ç®—å‡ºæ¥çš„ã€‚MaxScnæ˜¯ä¸€ä¸ª64ä½çš„longå‹æ•°æ®ã€‚</p>
<!-- more -->
<h2 id="idå’Œpositionè½¬æˆmaxscn">idå’Œpositionè½¬æˆMaxScn</h2>
<p>databusä¼šå°†mysqlçš„binlog file idå’Œpositionè¯»å‡ºæ¥ï¼Œä¾‹å¦‚file nameä¸ºmysql-bin.000028ï¼Œidä¸º000028ï¼Œpositionä¸º208272177ã€‚
æ‹¿åˆ°idå’Œpositionåé€šè¿‡ä½è¿ç®—å°†000028å·¦ç§»32ä½è½¬æˆ120259084288ä½œä¸ºMaxScnçš„é«˜32ä½ï¼Œå°†208272177ä½œä¸ºMaxScnçš„ä½32ä½ã€‚
120259084288 ä¸208272177è¿›è¡Œæˆ–è¿ç®—(|)å¾—åˆ°120467356465å³ä¸ºå½“å‰çš„scnã€‚</p>
<pre><code class="language-java">/**
 * Creates the SCN from logId and offset
 *   SCN = {          Logid           }{         Offset         }
 *         |--- High Order 32 bits ---||--- Low Order 32 bits --|
 * @param logId
 * @param offset
 * @return
 */
public static long scn(int logId, int offset)
{
  long scn = logId;
  scn &lt;&lt;= 32;
  scn |= offset;
  return scn;
}

</code></pre>
<h2 id="maxscnè½¬æˆidå’Œposition">MaxScnè½¬æˆidå’Œposition</h2>
<p>ä»æ•°æ®åº“ä¸­åŠ è½½æ—¶åŒç†ï¼Œå°†å½“å‰scn 120467356465å³ç§»32ä½ï¼Œä½32ä½çš„ä¼šä¸¢å¤±ï¼Œåªå‰©ä¸‹28å³ä¸ºbinlog file idï¼Œç„¶åå†å°†scn  120467356465å’Œ0xFFFFFFFFè¿›è¡Œä¸è¿ç®—(&amp;)ï¼Œç›¸å½“äºå–scnçš„ä½32ä½å³ä¸ºpositionçš„å€¼208272177ã€‚</p>
<pre><code class="language-java">/**
 * Returns the logid ( upper 32 bits  of the SCN )
 * For e.g., mysql-bin.000001 is said to have an id 000001
 */
public static int logid(long scn)
{
  // During startup, read from the first binlog file
  if (scn == -1 || scn == 0)
  {
    return 1;
  }
  return (int)((scn &gt;&gt; 32) &amp; 0xFFFFFFFF);
}

/**
 * Returns the binlogoffset ( lower 32 bits  of the SCN )
 */
public static int offset(long scn)
{
  // During startup, read from offset 0 (or should it be 4)
  if (scn == -1 || scn == 0)
  {
    return 4;
  }
  return (int)(scn &amp; 0xFFFFFFFF);
}


</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Hello Gridea]]></title>
        <id>https://zbx1719.github.io/post/hello-gridea</id>
        <link href="https://zbx1719.github.io/post/hello-gridea">
        </link>
        <updated>2018-12-11T16:00:00.000Z</updated>
        <summary type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
]]></summary>
        <content type="html"><![CDATA[<p>ğŸ‘  æ¬¢è¿ä½¿ç”¨ <strong>Gridea</strong> ï¼<br>
âœï¸  <strong>Gridea</strong> ä¸€ä¸ªé™æ€åšå®¢å†™ä½œå®¢æˆ·ç«¯ã€‚ä½ å¯ä»¥ç”¨å®ƒæ¥è®°å½•ä½ çš„ç”Ÿæ´»ã€å¿ƒæƒ…ã€çŸ¥è¯†ã€ç¬”è®°ã€åˆ›æ„... ...</p>
<!-- more -->
<p><a href="https://github.com/getgridea/gridea">Github</a><br>
<a href="http://hvenotes.fehey.com/">Gridea ä¸»é¡µ</a><br>
<a href="http://fehey.com/">ç¤ºä¾‹ç½‘ç«™</a></p>
<h2 id="ç‰¹æ€§">ç‰¹æ€§ğŸ‘‡</h2>
<p>ğŸ“  ä½ å¯ä»¥ä½¿ç”¨æœ€é…·çš„ <strong>Markdown</strong> è¯­æ³•ï¼Œè¿›è¡Œå¿«é€Ÿåˆ›ä½œ</p>
<p>ğŸŒ‰  ä½ å¯ä»¥ç»™æ–‡ç« é…ä¸Šç²¾ç¾çš„å°é¢å›¾å’Œåœ¨æ–‡ç« ä»»æ„ä½ç½®æ’å…¥å›¾ç‰‡</p>
<p>ğŸ·ï¸  ä½ å¯ä»¥å¯¹æ–‡ç« è¿›è¡Œæ ‡ç­¾åˆ†ç»„</p>
<p>ğŸ“‹  ä½ å¯ä»¥è‡ªå®šä¹‰èœå•ï¼Œç”šè‡³å¯ä»¥åˆ›å»ºå¤–éƒ¨é“¾æ¥èœå•</p>
<p>ğŸ’»  ä½ å¯ä»¥åœ¨ <strong>ğ–¶ğ—‚ğ—‡ğ–½ğ—ˆğ—ğ—Œ</strong> æˆ– <strong>ğ–¬ğ–ºğ–¼ğ–®ğ–²</strong> è®¾å¤‡ä¸Šä½¿ç”¨æ­¤å®¢æˆ·ç«¯</p>
<p>ğŸŒ  ä½ å¯ä»¥ä½¿ç”¨ <strong>ğ–¦ğ—‚ğ—ğ—ğ—ğ–» ğ–¯ğ–ºğ—€ğ–¾ğ—Œ</strong> æˆ– <strong>Coding Pages</strong> å‘ä¸–ç•Œå±•ç¤ºï¼Œæœªæ¥å°†æ”¯æŒæ›´å¤šå¹³å°</p>
<p>ğŸ’¬  ä½ å¯ä»¥è¿›è¡Œç®€å•çš„é…ç½®ï¼Œæ¥å…¥ <a href="https://github.com/gitalk/gitalk">Gitalk</a> æˆ– <a href="https://github.com/SukkaW/DisqusJS">DisqusJS</a> è¯„è®ºç³»ç»Ÿ</p>
<p>ğŸ‡¬ğŸ‡§  ä½ å¯ä»¥ä½¿ç”¨<strong>ä¸­æ–‡ç®€ä½“</strong>æˆ–<strong>è‹±è¯­</strong></p>
<p>ğŸŒ  ä½ å¯ä»¥ä»»æ„ä½¿ç”¨åº”ç”¨å†…é»˜è®¤ä¸»é¢˜æˆ–ä»»æ„ç¬¬ä¸‰æ–¹ä¸»é¢˜ï¼Œå¼ºå¤§çš„ä¸»é¢˜è‡ªå®šä¹‰èƒ½åŠ›</p>
<p>ğŸ–¥  ä½ å¯ä»¥è‡ªå®šä¹‰æºæ–‡ä»¶å¤¹ï¼Œåˆ©ç”¨ OneDriveã€ç™¾åº¦ç½‘ç›˜ã€iCloudã€Dropbox ç­‰è¿›è¡Œå¤šè®¾å¤‡åŒæ­¥</p>
<p>ğŸŒ± å½“ç„¶ <strong>Gridea</strong> è¿˜å¾ˆå¹´è½»ï¼Œæœ‰å¾ˆå¤šä¸è¶³ï¼Œä½†è¯·ç›¸ä¿¡ï¼Œå®ƒä¼šä¸åœå‘å‰ğŸƒ</p>
<p>æœªæ¥ï¼Œå®ƒä¸€å®šä¼šæˆä¸ºä½ ç¦»ä¸å¼€çš„ä¼™ä¼´</p>
<p>å°½æƒ…å‘æŒ¥ä½ çš„æ‰åå§ï¼</p>
<p>ğŸ˜˜ Enjoy~</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Debeziuméƒ¨ç½²(PostgreSQL)]]></title>
        <id>https://zbx1719.github.io/post/K6lOn74xg</id>
        <link href="https://zbx1719.github.io/post/K6lOn74xg">
        </link>
        <updated>2018-06-05T00:56:23.000Z</updated>
        <summary type="html"><![CDATA[<p>debeziumæ˜¯ä¸€ä¸ªç”¨äºæŠ“å–æ•°æ®åº“å˜æ›´äº‹ä»¶çš„å¼€æºé¡¹ç›®,å®ƒå¯ä»¥å°†æ•°æ®å®æ—¶çš„ä»æ•°æ®åº“ä¸­æŠ½å–å‡ºæ¥å¹¶é€šè¿‡kafka connectæ¨é€åˆ°kafkaä¸­.æ¯ä¸€ä¸ªéƒ¨ç½²åˆ° Kafkaçš„è¿æ¥å™¨éƒ½å¯ä»¥é€šè¿‡ä¸€ä¸ªæˆ–è€…å¤šä¸ªä¸»é¢˜( æ¯ä¸ªæ•°æ®åº“è¡¨é€šå¸¸æœ‰ä¸€ä¸ªä¸»é¢˜) æ•è·æ‰€æœ‰çš„å˜æ›´å¹¶è®°å½•åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªæœåŠ¡å™¨ä¸Šã€‚ Kafka ç¡®ä¿æ‰€æœ‰è¿™äº›æ•°æ®æ›´æ”¹äº‹ä»¶è¢«å¤åˆ¶å’Œå®Œå…¨æœ‰åºï¼Œå¹¶ä¸”å…è®¸è®¸å¤šå®¢æˆ·ç«¯ç‹¬ç«‹ä½¿ç”¨è¿™äº›ç›¸åŒçš„æ•°æ®</p>
]]></summary>
        <content type="html"><![CDATA[<p>debeziumæ˜¯ä¸€ä¸ªç”¨äºæŠ“å–æ•°æ®åº“å˜æ›´äº‹ä»¶çš„å¼€æºé¡¹ç›®,å®ƒå¯ä»¥å°†æ•°æ®å®æ—¶çš„ä»æ•°æ®åº“ä¸­æŠ½å–å‡ºæ¥å¹¶é€šè¿‡kafka connectæ¨é€åˆ°kafkaä¸­.æ¯ä¸€ä¸ªéƒ¨ç½²åˆ° Kafkaçš„è¿æ¥å™¨éƒ½å¯ä»¥é€šè¿‡ä¸€ä¸ªæˆ–è€…å¤šä¸ªä¸»é¢˜( æ¯ä¸ªæ•°æ®åº“è¡¨é€šå¸¸æœ‰ä¸€ä¸ªä¸»é¢˜) æ•è·æ‰€æœ‰çš„å˜æ›´å¹¶è®°å½•åœ¨ä¸€ä¸ªæˆ–è€…å¤šä¸ªæœåŠ¡å™¨ä¸Šã€‚ Kafka ç¡®ä¿æ‰€æœ‰è¿™äº›æ•°æ®æ›´æ”¹äº‹ä»¶è¢«å¤åˆ¶å’Œå®Œå…¨æœ‰åºï¼Œå¹¶ä¸”å…è®¸è®¸å¤šå®¢æˆ·ç«¯ç‹¬ç«‹ä½¿ç”¨è¿™äº›ç›¸åŒçš„æ•°æ®</p>
<!-- more -->
<h2 id="å‡†å¤‡">å‡†å¤‡</h2>
<p>éƒ¨ç½²debeziumæœ‰å‡ ç‚¹è¦æ±‚:</p>
<ul>
<li>PostgreSQLç‰ˆæœ¬9.4+</li>
<li>kafkaç‰ˆæœ¬0.9.0+</li>
</ul>
<p>PostgreSQLç‰ˆæœ¬éœ€è¦å‡çº§åˆ°9.4ä»¥ä¸Šæ˜¯å› ä¸ºä»9.4ç‰ˆæœ¬å¼€å§‹,PostgreSQLå¼•å…¥äº†logical decodingÂ åŠŸèƒ½,å®ƒå…è®¸ç¬¬ä¸‰æ–¹é€»è¾‘è§£ç æ’ä»¶å°†å®ƒçš„äº‹åŠ¡æ—¥å¿—è¾“å‡º.
kafka åœ¨0.9.0ç‰ˆæœ¬åæ”¯æŒkafka connect,debeziumæœ¬è´¨ä¸Šæ˜¯kafka connectæ’ä»¶,å› æ­¤éœ€è¦æœ‰kafka connectçš„æ”¯æŒ.</p>
<h2 id="æ•°æ®åº“é…ç½®">æ•°æ®åº“é…ç½®</h2>
<p>åœ¨éƒ¨ç½²debeziumå‰éœ€è¦å¯¹PostgreSQLè¿›è¡Œé…ç½®.æˆ‘ä½¿ç”¨çš„æ˜¯9.4ç‰ˆæœ¬çš„åº“.debeziumæ”¯æŒä¸¤ä¸ªé€»è¾‘è§£ç æ’ä»¶
<a href="https://github.com/debezium/postgres-decoderbufs">Protobuf based</a>å’Œ<a href="https://github.com/eulerto/wal2json">wal2json</a>.å› ä¸ºProtobuf basedè¦æ±‚æ•°æ®åº“ç‰ˆæœ¬åœ¨9.6ä»¥ä¸Š,å› æ­¤æˆ‘é‡‡ç”¨äº†wal2jsoné…ç½®.</p>
<h3 id="ç¼–è¯‘å®‰è£…">ç¼–è¯‘å®‰è£…</h3>
<pre><code># é€šè¿‡ä»githubä¸Šä¸‹è½½æ’ä»¶æºç 
$ git clone https://github.com/eulerto/wal2json.git
# ç¼–è¯‘å®‰è£…æ’ä»¶
$ PATH=/path/to/bin/pg_config:$PATH
$ USE_PGXS=1 make
$ USE_PGXS=1 make install
</code></pre>
<h3 id="ä¿®æ”¹é…ç½®">ä¿®æ”¹é…ç½®</h3>
<h4 id="postgresqlconf">postgresql.conf</h4>
<p>éœ€è¦ä¿®æ”¹ä»¥ä¸‹é…ç½®</p>
<pre><code>listen_addresses = '*'  
wal_level = logical
max_replication_slots = 1
max_wal_senders = 1
# MODULES
shared_preload_libraries = 'wal2json'
</code></pre>
<p>max_replication_slots,max_wal_sendersä¸¤é¡¹é…ç½®å¯ä»¥æ ¹æ®éœ€æ±‚æ¥è°ƒå¤§.é…ç½®ä¿®æ”¹åéœ€è¦é‡å¯æ•°æ®åº“ä½¿é…ç½®ç”Ÿæ•ˆ</p>
<h3 id="pg_hbaconf">pg_hba.conf</h3>
<pre><code># TYPE  DATABASE        USER            ADDRESS                 METHOD
host    all             all             0.0.0.0/0               md5
# &quot;local&quot; is for Unix domain socket connections only
local   all             all                                     peer
# IPv4 local connections:
host    all             all             127.0.0.1/32            ident
# IPv6 local connections:
host    all             all             ::1/128                 ident
# Allow replication connections from localhost, by a user with the
# replication privilege.
local   replication     postgres                                trust
host    replication     postgres        127.0.0.1/32            trust
host    replication     postgres        ::1/128                 trust

#wal2json
local    replication     all                     trust
</code></pre>
<p>ä¿®æ”¹åé‡å¯æ•°æ®åº“ç”Ÿæ•ˆ</p>
<h2 id="debeziuméƒ¨ç½²">debeziuméƒ¨ç½²</h2>
<ol>
<li>
<p>ä¸‹è½½<a href="https://www.confluent.io/download/">confluent</a>,è§£å‹åˆ°ä»»æ„ç›®å½•ä¸‹.</p>
</li>
<li>
<p>ä¸‹è½½<a href="https://repo1.maven.org/maven2/io/debezium/debezium-connector-postgres/0.7.5/debezium-connector-postgres-0.7.5-plugin.tar.gz">Postgres Connector plugin archive</a>,è§£å‹åæ”¾åˆ°confluentç›®å½•çš„ share/java/ è·¯å¾„ä¸‹.è§£å‹åçš„åŒ…åä¸ºdebezium-connector-postgres</p>
</li>
<li>
<p>åˆ›å»ºdebeziumé…ç½®æ–‡ä»¶debezium.properties:</p>
<pre><code> name=events-debezium
 tasks.max=1
 connector.class=io.debezium.connector.postgresql.PostgresConnector
 database.hostname=localhost
 database.port=5432
 database.user=postgres
 database.password=postgres
 database.dbname=postgres
 database.history.kafka.bootstrap.servers=localhost:9092
 database.server.id=1
 database.server.name=postgres.localhost
 plugin.name=wal2json
 include.schema.changes=true
</code></pre>
</li>
<li>
<p>è¿›å…¥confluentç›®å½•ä¸‹,å¯åŠ¨zookeeper:</p>
<pre><code> sudo bin/zookeeper-server-start -daemon etc/kafka/zookeeper.properties
</code></pre>
</li>
<li>
<p>å¯åŠ¨kafka:</p>
<pre><code> sudo bin/kafka-server-start -daemon etc/kafka/server.properties
</code></pre>
</li>
<li>
<p>å¯åŠ¨kafka connect:</p>
<pre><code> sudo bin/connect-standalone etc/kafka/connect-standalone.properties etc/kafka-connect-postgres/debezium.properties
</code></pre>
</li>
<li>
<p>kafka connectå¯åŠ¨åä¼šä¸ºæ¯ä¸€å¼ è¡¨å»ºç«‹ä¸€ä¸ªtopic,é€šè¿‡kafka consumerå‘½ä»¤ç›‘å¬æŸä¸€ä¸ªtopic,ç„¶åè¿›è¡Œupdateæ“ä½œ,å¯ä»¥çœ‹åˆ°:</p>
<pre><code> {&quot;schema&quot;:{&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[{&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[{&quot;type&quot;:&quot;int32&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;a&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;b&quot;},{&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:false,&quot;name&quot;:&quot;io.debezium.time.NanoTimestamp&quot;,&quot;version&quot;:1,&quot;field&quot;:&quot;c&quot;}],&quot;optional&quot;:true,&quot;name&quot;:&quot;postgres.localhost.public.table_with_pk.Value&quot;,&quot;field&quot;:&quot;before&quot;},{&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[{&quot;type&quot;:&quot;int32&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;a&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;b&quot;},{&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:false,&quot;name&quot;:&quot;io.debezium.time.NanoTimestamp&quot;,&quot;version&quot;:1,&quot;field&quot;:&quot;c&quot;}],&quot;optional&quot;:true,&quot;name&quot;:&quot;postgres.localhost.public.table_with_pk.Value&quot;,&quot;field&quot;:&quot;after&quot;},{&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[{&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;version&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;name&quot;},{&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;ts_usec&quot;},{&quot;type&quot;:&quot;int32&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;txId&quot;},{&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;lsn&quot;},{&quot;type&quot;:&quot;boolean&quot;,&quot;optional&quot;:true,&quot;default&quot;:false,&quot;field&quot;:&quot;snapshot&quot;},{&quot;type&quot;:&quot;boolean&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;last_snapshot_record&quot;}],&quot;optional&quot;:false,&quot;name&quot;:&quot;io.debezium.connector.postgresql.Source&quot;,&quot;field&quot;:&quot;source&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;op&quot;},{&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;ts_ms&quot;}],&quot;optional&quot;:false,&quot;name&quot;:&quot;postgres.localhost.public.table_with_pk.Envelope&quot;},&quot;payload&quot;:{&quot;before&quot;:{&quot;a&quot;:6,&quot;b&quot;:null,&quot;c&quot;:1526983438558366000},&quot;after&quot;:null,&quot;source&quot;:{&quot;version&quot;:&quot;0.7.5&quot;,&quot;name&quot;:&quot;postgres.localhost&quot;,&quot;ts_usec&quot;:1528103530924231000,&quot;txId&quot;:1927,&quot;lsn&quot;:24850324,&quot;snapshot&quot;:false,&quot;last_snapshot_record&quot;:null},&quot;op&quot;:&quot;d&quot;,&quot;ts_ms&quot;:1528103530926}}
 {&quot;schema&quot;:null,&quot;payload&quot;:null}
 {&quot;schema&quot;:{&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[{&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[{&quot;type&quot;:&quot;int32&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;a&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;b&quot;},{&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:false,&quot;name&quot;:&quot;io.debezium.time.NanoTimestamp&quot;,&quot;version&quot;:1,&quot;field&quot;:&quot;c&quot;}],&quot;optional&quot;:true,&quot;name&quot;:&quot;postgres.localhost.public.table_with_pk.Value&quot;,&quot;field&quot;:&quot;before&quot;},{&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[{&quot;type&quot;:&quot;int32&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;a&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;b&quot;},{&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:false,&quot;name&quot;:&quot;io.debezium.time.NanoTimestamp&quot;,&quot;version&quot;:1,&quot;field&quot;:&quot;c&quot;}],&quot;optional&quot;:true,&quot;name&quot;:&quot;postgres.localhost.public.table_with_pk.Value&quot;,&quot;field&quot;:&quot;after&quot;},{&quot;type&quot;:&quot;struct&quot;,&quot;fields&quot;:[{&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;version&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;name&quot;},{&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;ts_usec&quot;},{&quot;type&quot;:&quot;int32&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;txId&quot;},{&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;lsn&quot;},{&quot;type&quot;:&quot;boolean&quot;,&quot;optional&quot;:true,&quot;default&quot;:false,&quot;field&quot;:&quot;snapshot&quot;},{&quot;type&quot;:&quot;boolean&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;last_snapshot_record&quot;}],&quot;optional&quot;:false,&quot;name&quot;:&quot;io.debezium.connector.postgresql.Source&quot;,&quot;field&quot;:&quot;source&quot;},{&quot;type&quot;:&quot;string&quot;,&quot;optional&quot;:false,&quot;field&quot;:&quot;op&quot;},{&quot;type&quot;:&quot;int64&quot;,&quot;optional&quot;:true,&quot;field&quot;:&quot;ts_ms&quot;}],&quot;optional&quot;:false,&quot;name&quot;:&quot;postgres.localhost.public.table_with_pk.Envelope&quot;},&quot;payload&quot;:{&quot;before&quot;:null,&quot;after&quot;:{&quot;a&quot;:7,&quot;b&quot;:&quot;Replication&quot;,&quot;c&quot;:1526983438558366000},&quot;source&quot;:{&quot;version&quot;:&quot;0.7.5&quot;,&quot;name&quot;:&quot;postgres.localhost&quot;,&quot;ts_usec&quot;:1528103530924231000,&quot;txId&quot;:1927,&quot;lsn&quot;:24850324,&quot;snapshot&quot;:false,&quot;last_snapshot_record&quot;:null},&quot;op&quot;:&quot;c&quot;,&quot;ts_ms&quot;:1528103530926}}
</code></pre>
</li>
</ol>
<p>ç¬¬ä¸€ä¸ªjsonæ˜¯updateå‰çš„,å…¶ä¸­payloadæ˜¯updateå‰çš„å€¼.</p>
<pre><code>{&quot;before&quot;:{&quot;a&quot;:6,&quot;b&quot;:null,&quot;c&quot;:1526983438558366000},&quot;after&quot;:null,&quot;source&quot;:{&quot;version&quot;:&quot;0.7.5&quot;,&quot;name&quot;:&quot;postgres.localhost&quot;,&quot;ts_usec&quot;:1528103530924231000,&quot;txId&quot;:1927,&quot;lsn&quot;:24850324,&quot;snapshot&quot;:false,&quot;last_snapshot_record&quot;:null},&quot;op&quot;:&quot;d&quot;,&quot;ts_ms&quot;:1528103530926}
</code></pre>
<p>æœ€åä¸€ä¸ªjsonæ˜¯updateåçš„,payloadä¸­æ˜¯updateåçš„å€¼.</p>
<pre><code>{&quot;before&quot;:null,&quot;after&quot;:{&quot;a&quot;:7,&quot;b&quot;:&quot;Replication&quot;,&quot;c&quot;:1526983438558366000},&quot;source&quot;:{&quot;version&quot;:&quot;0.7.5&quot;,&quot;name&quot;:&quot;postgres.localhost&quot;,&quot;ts_usec&quot;:1528103530924231000,&quot;txId&quot;:1927,&quot;lsn&quot;:24850324,&quot;snapshot&quot;:false,&quot;last_snapshot_record&quot;:null},&quot;op&quot;:&quot;c&quot;,&quot;ts_ms&quot;:1528103530926}
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[ ehcacheæŒä¹…åŒ–åˆ°ç¡¬ç›˜indexä¸¢å¤±é—®é¢˜]]></title>
        <id>https://zbx1719.github.io/post/ScNrbDsX8</id>
        <link href="https://zbx1719.github.io/post/ScNrbDsX8">
        </link>
        <updated>2018-03-05T23:00:31.000Z</updated>
        <summary type="html"><![CDATA[<p>ehcacheæŒä¹…åŒ–åˆ°ç¡¬ç›˜åä¼šå‡ºç°ä»¥.indexç»“å°¾çš„ç´¢å¼•æ–‡ä»¶å’Œä»¥.dataç»“å°¾çš„æ•°æ®æ–‡ä»¶.å½“ehcacheé‡å¯æ—¶ä¼šä»ç¡¬ç›˜ä¸­åŠ è½½æ•°æ®ç¼“å­˜åˆ°å†…å­˜ä¸­.</p>
]]></summary>
        <content type="html"><![CDATA[<p>ehcacheæŒä¹…åŒ–åˆ°ç¡¬ç›˜åä¼šå‡ºç°ä»¥.indexç»“å°¾çš„ç´¢å¼•æ–‡ä»¶å’Œä»¥.dataç»“å°¾çš„æ•°æ®æ–‡ä»¶.å½“ehcacheé‡å¯æ—¶ä¼šä»ç¡¬ç›˜ä¸­åŠ è½½æ•°æ®ç¼“å­˜åˆ°å†…å­˜ä¸­.</p>
<!-- more -->
<h1 id="é—®é¢˜">é—®é¢˜</h1>
<p>å½“ehcacheé…ç½®å¥½åå‘ehcacheä¸­æ’å…¥æ•°æ®,æ­£å¸¸åœæ­¢ehcacheæ—¶æœ¬åœ°å¯ä»¥çœ‹åˆ°å·²ç»æŒä¹…åŒ–åˆ°æœ¬åœ°çš„æ–‡ä»¶</p>
<pre><code>total 16
-rw-r--r--  1 zhubingxu  staff   2.1K  3  6 14:57 %0043itycode_%00561.data
-rw-r--r--  1 zhubingxu  staff   273B  3  6 14:57 %0043itycode_%00561.index
</code></pre>
<p>è¿™æ—¶å€™æŒä¹…åŒ–æ•°æ®æ˜¯æ­£å¸¸çš„.ç„¶è€Œå½“æœåŠ¡åœæ­¢åæˆ‘ä»¬é€šè¿‡è‡ªå·±å°è£…çš„æ¥å£ç›´æ¥æŸ¥è¯¢EhCacheä¸­çš„æ•°æ®æ—¶ä¼šå‘ç°ç¬¬ä¸€æ¬¡æŸ¥è¯¢è¿”å›çš„ç»“æœæ˜¯æ­£å¸¸çš„,ç¬¬äºŒæ¬¡æŸ¥è¯¢å‘ç°è¿”å›çš„ç»“æœä¸ºnull.</p>
<pre><code>ç¬¬ä¸€æ¬¡è°ƒç”¨ç»“æœ
1520317305023

ç¬¬äºŒæ¬¡è°ƒç”¨ç»“æœ
null
</code></pre>
<p>æŸ¥çœ‹æŒä¹…åŒ–æ–‡ä»¶å‘ç°.dataæ–‡ä»¶è¿˜å­˜åœ¨è€Œ.indexç´¢å¼•æ–‡ä»¶ä¸¢å¤±äº†.</p>
<h1 id="åŸå› ">åŸå› </h1>
<p>ehcacheæ¢å¤æ•°æ®æ˜¯æ ¹æ®.indexç´¢å¼•æ–‡ä»¶æ¥è¿›è¡Œæ•°æ®æ¢å¤çš„.å½“ç¨‹åºè¿è¡Œå,ehcacheçš„ä¸€ä¸ªæ–¹æ³•ä¼šå°†.dataæ–‡ä»¶å’Œ.indexæ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´è¿›è¡Œæ¯”è¾ƒ,å¦‚æœä¸ç¬¦åˆç›´æ¥å°†.indexæ–‡ä»¶åˆ é™¤.ç¬¬ä¸€æ¬¡è°ƒç”¨å.indexæ–‡ä»¶çš„ä¿®æ”¹æ—¶é—´ä¸ä¼šå˜,è€Œ.dataçš„ä¿®æ”¹æ—¶é—´ä¼šå˜æˆå½“å‰æ—¶é—´.æ‰€ä»¥ç¬¬äºŒæ¬¡æŸ¥è¯¢æ—¶ç”±äºä¿®æ”¹æ—¶é—´çš„å˜åŒ–å¯¼è‡´.indexæ–‡ä»¶è¢«åˆ é™¤æ— æ³•åŠ è½½ä¹‹å‰ç¼“å­˜ä¸­çš„æ•°æ®,è¿”å›null.</p>
<pre><code>ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶çš„ç»“æœ
å¯ä»¥å‘ç°.dataæ–‡ä»¶æ—¶é—´æ›´æ–°äº†
total 16
-rw-r--r--  1 zhubingxu  staff   2.1K  3  6 15:38 %0043itycode_%00561.data
-rw-r--r--  1 zhubingxu  staff   273B  3  6 14:57 %0043itycode_%00561.index
</code></pre>
<p>è€Œehcacheçš„.indexæ–‡ä»¶å’Œ.dataæ–‡ä»¶æ—¶é—´ä¸ä¸€è‡´çš„åŸå› æ˜¯ehcacheæ˜¯åœ¨åœæ­¢çš„æ—¶å€™é€šè¿‡è§¦å‘ä¸€ä¸ªäº‹ä»¶æ¥ç”Ÿæˆ.indexæ–‡ä»¶çš„,è€Œæˆ‘ä»¬éæ­£å¸¸åœæ­¢æ˜¯ä¸ä¼šè§¦å‘è¿™ä¸ªäº‹ä»¶çš„,è¿™å°±å¯¼è‡´.dataæ—¶é—´æ›´æ–°äº†è€Œ.indexæ—¶é—´ä¸å˜.</p>
<h1 id="è§£å†³åŠæ³•">è§£å†³åŠæ³•</h1>
<p>å› ä¸ºéæ­£å¸¸å…³é—­æ˜¯ä¸ä¼šè§¦å‘å†™å…¥.indexæ–‡ä»¶è¿™ä¸ªæ–¹æ³•,å› æ­¤æˆ‘ä»¬å°±è¦æ‰‹åŠ¨æ¥æ‰§è¡Œè¿™ä¸ªæ–¹æ³•.
é¦–å…ˆåœ¨staticä¸­åŠ å…¥è¿™è¡Œä»£ç </p>
<pre><code>System.setProperty(net.sf.ehcache.CacheManager.ENABLE_SHUTDOWN_HOOK_PROPERTY,&quot;true&quot;);
</code></pre>
<p>å¦‚ä¸‹æ‰€ç¤º</p>
<pre><code>static {
try {
    InputStream inputStream = EhCacheWrap.class.getResourceAsStream(&quot;/databuscache.xml&quot;);
    System.setProperty(net.sf.ehcache.CacheManager.ENABLE_SHUTDOWN_HOOK_PROPERTY,&quot;true&quot;);
    manager = new CacheManager(inputStream);
    if (manager == null) {
        manager = CacheManager.create();
    }
} catch (CacheException var1) {
    var1.printStackTrace();
    System.out.println(&quot;ï¼ï¼ï¼Initialize cache manager failed.&quot; + var1);
    logger.fatal(&quot;ï¼ï¼ï¼Initialize cache manager failed.&quot;, var1);
}
</code></pre>
<p>}</p>
<p>ç„¶ååœ¨æ¯æ¬¡getCache()åéƒ½è¦è°ƒç”¨flush()æ–¹æ³•å®æ—¶å†™å…¥ç¡¬ç›˜.</p>
<pre><code>Cache cache=manager.getCache(arg0);
cache.flush();
</code></pre>
<p>ä¹‹åå†æµ‹è¯•å°±ä¼šå‘ç°è¯»å–ç¼“å­˜æ­£å¸¸äº†,ä¸ä¼šå‡ºç°ç¼“å­˜ä¸¢å¤±çš„æƒ…å†µ</p>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Databuséƒ¨ç½²(Oracle)]]></title>
        <id>https://zbx1719.github.io/post/R6g6QlehW</id>
        <link href="https://zbx1719.github.io/post/R6g6QlehW">
        </link>
        <updated>2018-01-12T00:48:33.000Z</updated>
        <summary type="html"><![CDATA[<p>databusæ”¯æŒä¸¤ç§æ•°æ®åº“:mysqlå’Œoracle.mysqlé‡‡ç”¨çš„æ˜¯bin-logæ–¹å¼,è¿™ç§æ–¹å¼é…ç½®èµ·æ¥ç®€å•.è¿˜æœ‰ä¸€ç§æ˜¯oracle.oracleç”±äºæ²¡æœ‰bin-logæœºåˆ¶,å› æ­¤é‡‡ç”¨å¦å¤–çš„ä¸€ç§æ–¹å¼</p>
]]></summary>
        <content type="html"><![CDATA[<p>databusæ”¯æŒä¸¤ç§æ•°æ®åº“:mysqlå’Œoracle.mysqlé‡‡ç”¨çš„æ˜¯bin-logæ–¹å¼,è¿™ç§æ–¹å¼é…ç½®èµ·æ¥ç®€å•.è¿˜æœ‰ä¸€ç§æ˜¯oracle.oracleç”±äºæ²¡æœ‰bin-logæœºåˆ¶,å› æ­¤é‡‡ç”¨å¦å¤–çš„ä¸€ç§æ–¹å¼</p>
<!-- more -->
<h1 id="databusç›‘æ§oracleåŸç†">databusç›‘æ§oracleåŸç†</h1>
<ul>
<li>æ¯ä¸ªæºè¡¨æ·»åŠ ä¸€ä¸ª txn åˆ—ã€‚æºè¡¨fooæœ€åˆæœ‰ä¸‰åˆ—(A,B,C)ï¼Œä¸ºäº†databusåŒ–éœ€è¦åœ¨æºè¡¨ä¸Šæ·»åŠ ä¸€ä¸ªtxnåˆ—ã€‚è¿™ä¸ªåˆ—è¦å»ºç«‹ç´¢å¼•ï¼Œå¦åˆ™å½±å“æŠ“å–æ•ˆç‡ã€‚</li>
<li>ä¸ºæ¯ä¸ªæ•°æ®åº“éƒ½åˆ›å»ºä¸€ä¸ªsy$txlogè¡¨ã€‚å®ƒè·Ÿè¸ªæ•°æ®åº“ä¸­databusåŒ–çš„æºè¡¨çš„äº‹åŠ¡å˜æ›´ã€‚å®ƒä¸»è¦çš„åˆ—æœ‰(scn, txn, mask, timestamp)ã€‚</li>
<li>æ¯ä¸ªæºè¡¨ä¸Šæœ‰ä¸€ä¸ªinsert/updateçš„å‰ç½®è§¦å‘å™¨ï¼Œå®ƒåšä¸¤ä»¶äº‹æƒ…ï¼š
<ul>
<li>è°ƒç”¨sync_core.getTxn()å¾—åˆ°å½“å‰çš„äº‹åŠ¡IDå¹¶æ’å…¥åˆ°æºè¡¨çš„txnåˆ—ã€‚</li>
<li>æ–°å¢æˆ–ä¿®æ”¹sy$txlogè¡¨ä¸­å¯¹åº”è®°å½•çš„Txnå¹¶ è®¾ç½®ä¸ºæ–°çš„txnidï¼Œscnåˆå§‹åŒ–ä¸ºæ— ç©·å¤§(99999999),å’Œä¸€ä¸ªæ–°çš„maskã€‚</li>
</ul>
</li>
<li>åœ¨åå°æœ‰ä¸€ä¸ªæ¯Nç§’æ‰§è¡Œä¸€æ¬¡çš„åˆå¹¶job(å½“å‰ä¸º2ç§’)ï¼Œå®ƒå°†sy$txlogè¡¨ä¸­scn=Infinityçš„è®°å½•çš„scnæ›´æ–°ä¸ºora_rowscnã€‚</li>
</ul>
<h1 id="é…ç½®databus">é…ç½®databus</h1>
<p>å…ˆä¸‹è½½æºç </p>
<pre><code>git clone  https://github.com/linkedin/databus/
</code></pre>
<p>å¤åˆ¶ <a href="databus-demo/ojdbc6-11.2.0.2.0.jar">ojdbc.jar</a>åˆ° sandbox-repo/com/oracle/ojdbc6/11.2.0.2.0/ è·¯å¾„ä¸‹</p>
<p>æ‰“å¼€</p>
<pre><code>databus-core/databus-core-container/src/main/java/com/linkedin/databus2/core/container/netty/ServerContainer.java
</code></pre>
<p>åœ¨ initializeContainerJmx() æ–¹æ³•ä¸­åŠ å…¥ä¸‹é¢è¿™å¥</p>
<pre><code>LocateRegistry.createRegistry(_containerStaticConfig.getJmx().getRmiRegistryPort());
</code></pre>
<p>ä¸åŠ çš„è¯ä¼šæŠ¥ Cannot bind to URL rmi://localhost:1099 ServiceUnavailableException</p>
<p>åŠ å®Œåç»“æœå¦‚ä¸‹</p>
<pre><code>protected void initializeContainerJmx()
{

if (_containerStaticConfig.getJmx().isRmiEnabled())
{
try
{
  JMXServiceURL jmxServiceUrl =
      new JMXServiceURL(&quot;service:jmx:rmi://&quot; +
                        _containerStaticConfig.getJmx().getJmxServiceHost() + &quot;:&quot; +
                        _containerStaticConfig.getJmx().getJmxServicePort() +&quot;/jndi/rmi://&quot; +
                        _containerStaticConfig.getJmx().getRmiRegistryHost() + &quot;:&quot; +
                        _containerStaticConfig.getJmx().getRmiRegistryPort() + &quot;/jmxrmi&quot; +
                        _containerStaticConfig.getJmx().getJmxServicePort());

  LocateRegistry.createRegistry(_containerStaticConfig.getJmx().getRmiRegistryPort());
  _jmxConnServer = JMXConnectorServerFactory.newJMXConnectorServer(jmxServiceUrl, null,
                                                                   getMbeanServer());
}
catch (Exception e)
{
  LOG.warn(&quot;Unable to instantiate JMX server&quot;, e);
}
}
}
</code></pre>
<p>é…ç½®è¢«ç›‘æ§è¡¨çš„ä¿¡æ¯:ä¿®æ”¹databus2-example-relay-pkg/conf/sources-person.jsonçš„å†…å®¹,å…¶ä¸­</p>
<pre><code>{
&quot;name&quot;: &quot;person&quot;,
&quot;id&quot;: 1,
&quot;uri&quot;: &quot;jdbc:oracle:thin:dbbus/dbbus@localhost:1521:orcl&quot;,
&quot;slowSourceQueryThreshold&quot;: 2000,
&quot;sources&quot;: [
    {
        &quot;id&quot;: 101,
        &quot;name&quot;: &quot;com.linkedin.events.example.person.Person&quot;,
        &quot;uri&quot;: &quot;dbbus.person&quot;,
        &quot;partitionFunction&quot;: &quot;constant:1&quot;
    }
]
</code></pre>
<p>}</p>
<h2 id="æ‰“åŒ…">æ‰“åŒ…</h2>
<p>åœ¨databusæ ¹ç›®å½•ä¸‹æ‰§è¡Œ</p>
<pre><code>gradle -Dopen_source=true assemble
</code></pre>
<h1 id="é…ç½®oracle">é…ç½®oracle</h1>
<p>databusé‡Œè‡ªå¸¦äº†é…ç½®è„šæœ¬,æˆ‘ä»¬å¯ä»¥ç”¨å®ƒæ¥å®ç°å¯¹oracleçš„å¿«é€Ÿé…ç½®
oracleé…ç½®è„šæœ¬ä½äºdatabusæ–‡ä»¶å¤¹ä¸‹çš„ /db/oracle/bin è·¯å¾„
é¦–å…ˆè¦æ‰§è¡Œ createUser.shè„šæœ¬,åœ¨æ‰§è¡Œä¹‹å‰éœ€è¦åšä¸€äº›ä¿®æ”¹:</p>
<pre><code>å°†ä¸‹é¢è¿™è¡Œçš„ system/manager\@${DBNAME} åˆ æ‰
sqlplus system/manager\@${DBNAME} as sysdba &lt;&lt; __EOF__
ä¿®æ”¹åå¦‚ä¸‹
sqlplus / as sysdba &lt;&lt; __EOF__
</code></pre>
<p>ç„¶åä¿®æ”¹ç¬¬57è¡Œ,å› ä¸ºæ²¡æœ‰temp1è¿™ä¸ªtablespace,æ‰€ä»¥åˆ°57è¡Œä¼šæŠ¥é”™,æˆ‘ä»¬è¦å°†temporary tablespace temp1åˆ æ‰.åˆ é™¤åçš„ä»£ç å¦‚ä¸‹:</p>
<pre><code>create user ${USER} identified by ${PASSWD} default tablespace ${TBS_UC} ;
</code></pre>
<p>åœ¨oracleç”¨æˆ·ä¸‹æ‰§è¡Œä»¥ä¸‹å‘½ä»¤åˆ›å»ºç”¨æˆ·dbbus/dbbus,å…¶ä¸­db_pathæ˜¯å­˜æ”¾oracleçš„.dbfæ–‡ä»¶çš„è·¯å¾„:</p>
<pre><code>#createUser.sh db_username db_password db_id db_table_space db_path
sh createUser.sh dbbus dbbus orcl tbs_dbbus /u01/app/oracle/product/11.2.0/dbs/
</code></pre>
<p>è¿è¡Œ createSchema.sh åœ¨oracleä¸­ç”Ÿæˆå¿…è¦çš„ package table seq tigger Procedure ç­‰</p>
<pre><code>#createSchema.sh db_username/db_password@db_id tab_and_view_path
sh createSchema.sh dbbus/dbbus@orcl /home/oracle/databus/databus2-example/database/person
</code></pre>
<p>å¯åŠ¨Relay:
* cd build/databus2-example-relay-pkg/distributions
* tar -zxvf databus2-example-relay-pkg.tar.gzè§£å‹
* æ‰§è¡Œå¯åŠ¨è„šæœ¬ ./bin/start-example-relay.sh person</p>
<p>å¯åŠ¨ Client:
* cd build/databus2-example-client-pkg/distributions
* tar -zxvf databus2-example-client-pkg.tar.gzè§£å‹
* æ‰§è¡Œå¯åŠ¨è„šæœ¬ ./bin/start-example-client.sh person</p>
<p>åœ¨oracleä¸­æ‰§è¡Œinsertè¯­å¥</p>
<pre><code>INSERT INTO person(id,first_name, last_name) VALUES(1,'balaji', 'varadaran');
</code></pre>
<p>è¿”å›ä¸‹é¢ç»“æœè¯æ˜æ­å»ºæˆåŠŸ</p>
<pre><code>2018-01-12 15:35:06,338 +1222808 [callback-1] (INFO) {PersonConsumer} firstName: balaji, lastName: varadaran, birthDate: null, deleted: false
</code></pre>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[Databuséƒ¨ç½²(MYSQL)]]></title>
        <id>https://zbx1719.github.io/post/JXEVTuER4</id>
        <link href="https://zbx1719.github.io/post/JXEVTuER4">
        </link>
        <updated>2017-12-19T07:23:19.000Z</updated>
        <summary type="html"><![CDATA[<p>Databusæ˜¯ä¸€ä¸ªç”±LinkedInå¼€æºçš„ä½å»¶è¿Ÿã€å¯é çš„ã€æ”¯æŒäº‹åŠ¡çš„ã€ä¿æŒä¸€è‡´æ€§çš„æ•°æ®å˜æ›´æŠ“å–ç³»ç»Ÿã€‚å®ƒæœ‰ä»¥ä¸‹ç‰¹ç‚¹:</p>
<ul>
<li><strong>æ¥æºç‹¬ç«‹</strong>ï¼šDatabusæ”¯æŒå¤šç§æ•°æ®æ¥æºçš„å˜æ›´æŠ“å–ï¼ŒåŒ…æ‹¬Oracleå’ŒMySQLã€‚</li>
<li><strong>å¯æ‰©å±•ã€é«˜åº¦å¯ç”¨</strong>ï¼šDatabusèƒ½æ‰©å±•åˆ°æ”¯æŒæ•°åƒæ¶ˆè´¹è€…å’Œäº‹åŠ¡æ•°æ®æ¥æºï¼ŒåŒæ—¶ä¿æŒé«˜åº¦å¯ç”¨æ€§ã€‚</li>
<li><strong>äº‹åŠ¡æŒ‰åºæäº¤</strong>ï¼šDatabusèƒ½ä¿æŒæ¥æºæ•°æ®åº“ä¸­çš„äº‹åŠ¡å®Œæ•´æ€§ï¼Œå¹¶æŒ‰ç…§äº‹åŠ¡åˆ†ç»„å’Œæ¥æºçš„æäº¤é¡ºå¯»äº¤ä»˜å˜æ›´äº‹ä»¶ã€‚</li>
<li><strong>ä½å»¶è¿Ÿã€æ”¯æŒå¤šç§è®¢é˜…æœºåˆ¶</strong>ï¼šæ•°æ®æºå˜æ›´å®Œæˆåï¼ŒDatabusèƒ½åœ¨æ¯«ç§’çº§å†…å°†äº‹åŠ¡æäº¤ç»™æ¶ˆè´¹è€…ã€‚åŒæ—¶ï¼Œæ¶ˆè´¹è€…ä½¿ç”¨Databusä¸­çš„æœåŠ¡å™¨ç«¯è¿‡æ»¤åŠŸèƒ½ï¼Œå¯ä»¥åªè·å–è‡ªå·±éœ€è¦çš„ç‰¹å®šæ•°æ®ã€‚</li>
<li><strong>æ— é™å›æº¯</strong>ï¼šå¯¹æ¶ˆè´¹è€…æ”¯æŒæ— é™å›æº¯èƒ½åŠ›ï¼Œä¾‹å¦‚å½“æ¶ˆè´¹è€…éœ€è¦äº§ç”Ÿæ•°æ®çš„å®Œæ•´æ‹·è´æ—¶ï¼Œå®ƒä¸ä¼šå¯¹æ•°æ®åº“äº§ç”Ÿä»»ä½•é¢å¤–è´Ÿæ‹…ã€‚å½“æ¶ˆè´¹è€…çš„æ•°æ®å¤§å¤§è½åäºæ¥æºæ•°æ®åº“æ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¯¥åŠŸèƒ½ã€‚</li>
</ul>
]]></summary>
        <content type="html"><![CDATA[<p>Databusæ˜¯ä¸€ä¸ªç”±LinkedInå¼€æºçš„ä½å»¶è¿Ÿã€å¯é çš„ã€æ”¯æŒäº‹åŠ¡çš„ã€ä¿æŒä¸€è‡´æ€§çš„æ•°æ®å˜æ›´æŠ“å–ç³»ç»Ÿã€‚å®ƒæœ‰ä»¥ä¸‹ç‰¹ç‚¹:</p>
<ul>
<li><strong>æ¥æºç‹¬ç«‹</strong>ï¼šDatabusæ”¯æŒå¤šç§æ•°æ®æ¥æºçš„å˜æ›´æŠ“å–ï¼ŒåŒ…æ‹¬Oracleå’ŒMySQLã€‚</li>
<li><strong>å¯æ‰©å±•ã€é«˜åº¦å¯ç”¨</strong>ï¼šDatabusèƒ½æ‰©å±•åˆ°æ”¯æŒæ•°åƒæ¶ˆè´¹è€…å’Œäº‹åŠ¡æ•°æ®æ¥æºï¼ŒåŒæ—¶ä¿æŒé«˜åº¦å¯ç”¨æ€§ã€‚</li>
<li><strong>äº‹åŠ¡æŒ‰åºæäº¤</strong>ï¼šDatabusèƒ½ä¿æŒæ¥æºæ•°æ®åº“ä¸­çš„äº‹åŠ¡å®Œæ•´æ€§ï¼Œå¹¶æŒ‰ç…§äº‹åŠ¡åˆ†ç»„å’Œæ¥æºçš„æäº¤é¡ºå¯»äº¤ä»˜å˜æ›´äº‹ä»¶ã€‚</li>
<li><strong>ä½å»¶è¿Ÿã€æ”¯æŒå¤šç§è®¢é˜…æœºåˆ¶</strong>ï¼šæ•°æ®æºå˜æ›´å®Œæˆåï¼ŒDatabusèƒ½åœ¨æ¯«ç§’çº§å†…å°†äº‹åŠ¡æäº¤ç»™æ¶ˆè´¹è€…ã€‚åŒæ—¶ï¼Œæ¶ˆè´¹è€…ä½¿ç”¨Databusä¸­çš„æœåŠ¡å™¨ç«¯è¿‡æ»¤åŠŸèƒ½ï¼Œå¯ä»¥åªè·å–è‡ªå·±éœ€è¦çš„ç‰¹å®šæ•°æ®ã€‚</li>
<li><strong>æ— é™å›æº¯</strong>ï¼šå¯¹æ¶ˆè´¹è€…æ”¯æŒæ— é™å›æº¯èƒ½åŠ›ï¼Œä¾‹å¦‚å½“æ¶ˆè´¹è€…éœ€è¦äº§ç”Ÿæ•°æ®çš„å®Œæ•´æ‹·è´æ—¶ï¼Œå®ƒä¸ä¼šå¯¹æ•°æ®åº“äº§ç”Ÿä»»ä½•é¢å¤–è´Ÿæ‹…ã€‚å½“æ¶ˆè´¹è€…çš„æ•°æ®å¤§å¤§è½åäºæ¥æºæ•°æ®åº“æ—¶ï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨è¯¥åŠŸèƒ½ã€‚</li>
</ul>
<!-- more -->
<h1 id="éƒ¨ç½²">éƒ¨ç½²</h1>
<h2 id="gradleå®‰è£…">gradleå®‰è£…</h2>
<p>Databusé‡‡ç”¨gradleç¼–è¯‘,å› æ­¤åœ¨ç¼–è¯‘å‰éœ€è¦å®‰è£…gradle</p>
<p>macOSå®‰è£…gradleæ–¹æ³•:</p>
<pre><code>brew install gradle
</code></pre>
<p>å®‰è£…å®Œæˆåè¾“å…¥ gradle -version å¦‚æœå‡ºç°ä»¥ä¸‹ä¿¡æ¯åˆ™å®‰è£…æˆåŠŸ</p>
<pre><code>------------------------------------------------------------
Gradle 4.3.1
------------------------------------------------------------

Build time:   2017-11-08 08:59:45 UTC
Revision:     e4f4804807ef7c2829da51877861ff06e07e006d

Groovy:       2.4.12
Ant:          Apache Ant(TM) version 1.9.6 compiled on June 29 2015
JVM:          1.8.0_131 (Oracle Corporation 25.131-b11)
OS:           Mac OS X 10.13.2 x86_64
</code></pre>
<h2 id="æ•°æ®åº“é…ç½®">æ•°æ®åº“é…ç½®</h2>
<p>å®‰è£…mysqlæ•°æ®åº“.æˆ‘ä½¿ç”¨çš„æ˜¯5.5.56ç‰ˆæœ¬.é«˜ç‰ˆæœ¬å¯èƒ½ä¼šæœ‰é—®é¢˜.
æ•°æ®åº“è¦å¼€å¯binlog,æŸ¥çœ‹æ˜¯å¦å¼€å¯çš„æ–¹æ³•æ˜¯</p>
<pre><code>  SHOW VARIABLES LIKE 'log_bin';
</code></pre>
<p>å¦‚æœæ²¡æœ‰å¼€å¯å¯ä»¥ç”¨</p>
<pre><code>SET SQL_LOG_BIN=1;
</code></pre>
<p>æ¥å¼€å¯.</p>
<p>å°†æ•°æ®åº“binlog_formatè®¾ç½®æˆROW.æŸ¥çœ‹binlog_formatæ–¹æ³•ä¸º</p>
<pre><code>SHOW VARIABLES LIKE 'binlog_format';
</code></pre>
<p>è®¾ç½®æ–¹æ³•ä¸º</p>
<pre><code>SET GLOBLE binlog_format =ROW;
</code></pre>
<p>å°† binlog_checksum è®¾ç½®ä¸ºç©º.æŸ¥çœ‹æ–¹æ³•ä¸º</p>
<pre><code>SHOW GLOBAL VARIABLES LIKE 'binlog_checksum';
</code></pre>
<p>è®¾ç½®æ–¹æ³•ä¸º</p>
<pre><code>SET binlog_checksum=NONE;
</code></pre>
<p>åœ¨mysqlä¸Šåˆ›å»ºåä¸ºor_testçš„æ•°æ®åº“</p>
<pre><code>CREATE DATABASE or_test;
</code></pre>
<p>å¹¶åœ¨or_testä¸Šåˆ›å»ºåä¸ºpersonçš„è¡¨:</p>
<pre><code>CREATE TABLE person
(
id INT(11) PRIMARY KEY NOT NULL,
first_name VARCHAR(120) NOT NULL,
last_name VARCHAR(120) NOT NULL,
birth_date DATE,
deleted VARCHAR(5) NOT NULL
);
</code></pre>
<h2 id="æºç é…ç½®">æºç é…ç½®</h2>
<p>å…ˆä¸‹è½½æºç </p>
<pre><code>git clone  https://github.com/linkedin/databus/
</code></pre>
<p>å¤åˆ¶ <a href="databus-demo/ojdbc6-11.2.0.2.0.jar">ojdbc.jar</a>åˆ° sandbox-repo/com/oracle/ojdbc6/11.2.0.2.0/ è·¯å¾„ä¸‹</p>
<p>æ‰“å¼€</p>
<pre><code>databus-core/databus-core-container/src/main/java/com/linkedin/databus2/core/container/netty/ServerContainer.java
</code></pre>
<p>åœ¨ initializeContainerJmx() æ–¹æ³•ä¸­åŠ å…¥ä¸‹é¢è¿™å¥</p>
<pre><code>LocateRegistry.createRegistry(_containerStaticConfig.getJmx().getRmiRegistryPort());
</code></pre>
<p>ä¸åŠ çš„è¯ä¼šæŠ¥ Cannot bind to URL rmi://localhost:1099 ServiceUnavailableException</p>
<p>åŠ å®Œåç»“æœå¦‚ä¸‹</p>
<pre><code>protected void initializeContainerJmx()
{

if (_containerStaticConfig.getJmx().isRmiEnabled())
{
try
{
  JMXServiceURL jmxServiceUrl =
      new JMXServiceURL(&quot;service:jmx:rmi://&quot; +
                        _containerStaticConfig.getJmx().getJmxServiceHost() + &quot;:&quot; +
                        _containerStaticConfig.getJmx().getJmxServicePort() +&quot;/jndi/rmi://&quot; +
                        _containerStaticConfig.getJmx().getRmiRegistryHost() + &quot;:&quot; +
                        _containerStaticConfig.getJmx().getRmiRegistryPort() + &quot;/jmxrmi&quot; +
                        _containerStaticConfig.getJmx().getJmxServicePort());

  LocateRegistry.createRegistry(_containerStaticConfig.getJmx().getRmiRegistryPort());
  _jmxConnServer = JMXConnectorServerFactory.newJMXConnectorServer(jmxServiceUrl, null,
                                                                   getMbeanServer());
}
catch (Exception e)
{
  LOG.warn(&quot;Unable to instantiate JMX server&quot;, e);
}
}
}
</code></pre>
<p>é…ç½®è¢«ç›‘æ§è¡¨çš„ä¿¡æ¯:ä¿®æ”¹databus2-example-relay-pkg/conf/sources-or-person.jsonçš„å†…å®¹,å…¶ä¸­
URI</p>
<pre><code>format:mysql://username/password@mysql_host[:mysql_port]/mysql_serverid/binlog_prefix,
</code></pre>
<p>æ³¨æ„%2Fä¸ºè½¬ä¹‰ç¬¦,ç”¨æˆ·åä¸ºroot,å¯†ç ä¸ºroot.å…¶ä¸­uriå¯¹åº”ç€mysqlä¸­çš„åº“åå’Œè¡¨å.</p>
<pre><code>{
&quot;name&quot; : &quot;person&quot;,
&quot;id&quot;  : 1,
&quot;uri&quot; : &quot;mysql://root%2Froot@localhost:3306/1/mysql-bin&quot;,
&quot;slowSourceQueryThreshold&quot; : 2000,
&quot;sources&quot; :
[
    {
    &quot;id&quot; : 40,
    &quot;name&quot; : &quot;com.linkedin.events.example.or_test.Person&quot;,
    &quot;uri&quot;: &quot;or_test.person&quot;,
    &quot;partitionFunction&quot; : &quot;constant:1&quot;
     }
]
}
</code></pre>
<p>databus2-example-relay-pkg/schemas_registry/ä¸‹å®šä¹‰personçš„Avro schemaæ–‡ä»¶com.linkedin.events.example.or_test.Person.1.avscï¼Œå…¶ä¸­1è¡¨ç¤ºç‰ˆæœ¬(Databusç›®å‰æ²¡æœ‰é’ˆå¯¹mysqlæä¾›ç”ŸæˆAvro schemaæ–‡ä»¶çš„å·¥å…·ï¼Œæ‰€ä»¥åªèƒ½æ‰‹å·¥ç¼–å†™)å…·ä½“å†…å®¹å¦‚ä¸‹æ‰€ç¤ºï¼š</p>
<pre><code>{
  &quot;name&quot; : &quot;Person_V1&quot;,
  &quot;doc&quot; : &quot;Auto-generated Avro schema for sy$person. Generated at Dec 04, 2012 05:07:05 PM PST&quot;,
  &quot;type&quot; : &quot;record&quot;,
  &quot;meta&quot; : &quot;dbFieldName=person;pk=id;&quot;,
  &quot;namespace&quot; : &quot;com.linkedin.events.example.or_test&quot;,
  &quot;fields&quot; : [ {
    &quot;name&quot; : &quot;id&quot;,
    &quot;type&quot; : [ &quot;long&quot;, &quot;null&quot; ],
    &quot;meta&quot; : &quot;dbFieldName=ID;dbFieldPosition=0;&quot;
  }, {
    &quot;name&quot; : &quot;firstName&quot;,
    &quot;type&quot; : [ &quot;string&quot;, &quot;null&quot; ],
    &quot;meta&quot; : &quot;dbFieldName=FIRST_NAME;dbFieldPosition=1;&quot;
  }, {
    &quot;name&quot; : &quot;lastName&quot;,
    &quot;type&quot; : [ &quot;string&quot;, &quot;null&quot; ],
    &quot;meta&quot; : &quot;dbFieldName=LAST_NAME;dbFieldPosition=2;&quot;
  }, {
    &quot;name&quot; : &quot;birthDate&quot;,
    &quot;type&quot; : [ &quot;long&quot;, &quot;null&quot; ],
    &quot;meta&quot; : &quot;dbFieldName=BIRTH_DATE;dbFieldPosition=3;&quot;
  }, {
    &quot;name&quot; : &quot;deleted&quot;,
    &quot;type&quot; : [ &quot;string&quot;, &quot;null&quot; ],
    &quot;meta&quot; : &quot;dbFieldName=DELETED;dbFieldPosition=4;&quot;
  } ]
}
</code></pre>
<p>æ³¨å†ŒAvro schemaåˆ°index.schemas_registryæ–‡ä»¶databus2-example-relay-pkg/schemas_registry/index.schemas_registryæ–‡ä»¶ä¸­,
æ·»åŠ è¡Œcom.linkedin.events.example.or_test.Person.1.avsc ï¼Œæ¯å®šä¹‰ä¸€ä¸ªAvro schemaéƒ½éœ€è¦æ·»åŠ è¿›å»ï¼Œrelayè¿è¡Œæ—¶ä¼šåˆ°æ­¤æ–‡ä»¶ä¸­æŸ¥æ‰¾è¡¨å¯¹åº”çš„å®šä¹‰çš„Avro schemaã€‚</p>
<h2 id="éƒ¨ç½²å¯åŠ¨">éƒ¨ç½²å¯åŠ¨</h2>
<p>è¿›å…¥databusæ ¹ç›®å½•æ‰§è¡Œå‘½ä»¤gradle -Dopen_source=true assembleå³å¯å®Œæˆbuild,æˆåŠŸååœ¨databusæ ¹ç›®å½•ä¸‹ç”Ÿæˆåä¸ºbuildçš„æ–‡ä»¶å¤¹</p>
<h3 id="å¯åŠ¨relay">å¯åŠ¨Relay:</h3>
<ul>
<li>cd build/databus2-example-relay-pkg/distributions</li>
<li>tar -zxvf databus2-example-relay-pkg.tar.gzè§£å‹</li>
<li>æ‰§è¡Œå¯åŠ¨è„šæœ¬ ./bin/start-example-relay.sh or_person -Y ./conf/sources-or-person.json</li>
<li>æ‰§è¡Œå‘½ä»¤ curl -s http://localhost:11115/sources è¿”å›å¦‚ä¸‹å†…å®¹è¯´æ˜å¯åŠ¨æˆåŠŸï¼š</li>
</ul>
<h3 id="å¯åŠ¨-client">å¯åŠ¨ Client:</h3>
<ul>
<li>cd build/databus2-example-client-pkg/distributions</li>
<li>tar -zxvf databus2-example-client-pkg.tar.gzè§£å‹</li>
<li>æ‰§è¡Œå¯åŠ¨è„šæœ¬ ./bin/start-example-client.sh person
æ‰§è¡Œå‘½ä»¤ curl http://localhost:11115/relayStats/outbound/http/clients è¿”å›å¦‚ä¸‹å†…å®¹è¯´æ˜å¯åŠ¨æˆåŠŸï¼š</li>
</ul>
<h2 id="æµ‹è¯•">æµ‹è¯•</h2>
<p>Relayå’ŒClientå¯åŠ¨æˆåŠŸåï¼Œå°±å·²ç»å¼€å§‹å¯¹personè¡¨è¿›è¡Œæ•°æ®å˜æ›´æ•è·äº†ï¼Œç°åœ¨å‘personè¡¨æ’å…¥ä¸€æ¡æ•°æ®:</p>
<pre><code>INSERT person VALUES (1,'zhangsan','lisi',20371231235959,0);
</code></pre>
<p>databus2-example-relay-pkg/distributions/logsä¸‹çš„relay.logè®°å½•å¦‚ä¸‹:</p>
<pre><code>2017-12-19 18:44:01,356 +148827 [ORListener_person] (INFO) {OpenReplicator_person} BEGIN sql: BEGIN
2017-12-19 18:44:01,357 +148828 [ORListener_person] (INFO) {OpenReplicator_person} startXtionQueryEvent[header=BinlogEventV4HeaderImpl[timestamp=1513680243000,eventType=2,serverId=1,eventLength=71,nextPosition=596,flags=8,timestampOfReceipt=1513680241355],threadId=1,elapsedTime=0,databaseNameLength=7,errorCode=0,statusVariablesLength=26,statusVariables=[QFlags2Code[flags=0], QSQLModeCode[sqlMode=2097152], QCatalogNzCode[catalogName=std], QCharsetCode[characterSetClient=33,collationConnection=33,collationServer=8]],databaseName=or_test,sql=BEGIN]
2017-12-19 18:44:01,357 +148828 [ORListener_person] (INFO) {DatabusThreadBase} Starting source: or_test.person
2017-12-19 18:44:01,357 +148828 [ORListener_person] (INFO) {DatabusThreadBase} INSERT INTO or_test.person
2017-12-19 18:44:01,359 +148830 [transactionWriter] (INFO) {person} src:com.linkedin.events.example.or_test.Person(40) #src:1 #evt:1 scn:34359739022 ms:-1 sizeInBytes:28 msEvent:1 msTimeElapsed:0 msQueryExec:-1 prodRate:0.00 consRate:-28.00
2017-12-19 18:44:01,363 +148834 [transactionWriter] (INFO) {person} src:person(0) #src:1 #evt:1 scn:34359739022 ms:-1 sizeInBytes:28 msEvent:1 msTimeElapsed:0 msQueryExec:-1 prodRate:0.00 consRate:-28.00
</code></pre>
<p>databus2-example-client-pkg/distributions/logsä¸‹çš„client.logè®°å½•å¦‚ä¸‹ï¼š</p>
<pre><code>2017-12-19 18:44:23,444 +443 [callback-1] (INFO) {PersonConsumer} firstName: zhangsan, lastName: lisi, birthDate: 2145801600000, deleted: 0
</code></pre>
<p>è‡³æ­¤,demoæ­å»ºå®Œæˆ.</p>
<h2 id="å‚è€ƒèµ„æ–™">å‚è€ƒèµ„æ–™</h2>
<ul>
<li><a href="https://github.com/linkedin/databus">databus GitHubåœ°å€</a></li>
<li><a href="http://www.jianshu.com/p/9df54eb1ec35">linkedin çš„ databus éƒ¨ç½²(ç®€ä¹¦)</a></li>
<li><a href="http://tech.lede.com/2017/05/24/rd/server/databus/">Databusæ¶æ„åˆ†æä¸åˆæ­¥å®è·µï¼ˆfor mysqlï¼‰</a></li>
</ul>
]]></content>
    </entry>
    <entry>
        <title type="html"><![CDATA[åœ¨Ubuntu17ä¸Šå®‰è£…Docker]]></title>
        <id>https://zbx1719.github.io/post/2fLpb8STQ</id>
        <link href="https://zbx1719.github.io/post/2fLpb8STQ">
        </link>
        <updated>2017-11-17T12:35:17.000Z</updated>
        <summary type="html"><![CDATA[<p>åœ¨Ubuntu17ä¸Šå®‰è£…Docker</p>
]]></summary>
        <content type="html"><![CDATA[<p>åœ¨Ubuntu17ä¸Šå®‰è£…Docker</p>
<!-- more -->
<h1 id="å‡†å¤‡">å‡†å¤‡</h1>
<ul>
<li>
<p>é¦–å…ˆå®‰è£…Dockeræ‰€éœ€çš„ä¾èµ–</p>
<pre><code>sudo apt-get update
sudo apt-get install apt-transport-https ca-certificates curl software-properties-common
</code></pre>
</li>
</ul>
<h1 id="å®‰è£…">å®‰è£…</h1>
<ul>
<li>
<p>ä¸ºäº†ç¡®è®¤æ‰€ä¸‹è½½è½¯ä»¶åŒ…çš„åˆæ³•æ€§ï¼Œéœ€è¦æ·»åŠ è½¯ä»¶æºçš„ GPG å¯†é’¥ã€‚</p>
<pre><code>curl -fsSL https://download.docker.com/linux/ubuntu/gpg | sudo apt-key add -
</code></pre>
</li>
<li>
<p>é€šè¿‡æœç´¢æŒ‡çº¹çš„æœ€å8ä¸ªå­—ç¬¦ï¼Œç¡®è®¤æ‚¨ç°åœ¨å·²ç»æ‹¥æœ‰æŒ‡çº¹9DC8 5822 9FC7 DD38 854A E2D8 8D81 803C 0EBF CD88çš„å¯†é’¥ã€‚</p>
<pre><code>sudo apt-key fingerprint 0EBFCD88
</code></pre>
</li>
<li>
<p>æ·»åŠ dockeræº</p>
<pre><code>sudo add-apt-repository &quot;deb [arch=amd64] https://download.docker.com/linux/ubuntu $(lsb_release -cs) stable&quot;
</code></pre>
</li>
<li>
<p>æ›´æ–°apt-getå¹¶å®‰è£…docker</p>
<pre><code>sudo apt-get update
sudo apt-get install docker-ce
</code></pre>
</li>
<li>
<p>å¯åŠ¨docker</p>
<pre><code>sudo service docker start
</code></pre>
</li>
</ul>
<h1 id="é—®é¢˜">é—®é¢˜</h1>
<ul>
<li>
<p>å¦‚æœè¿è¡Œå‘½ä»¤é‡åˆ°é—®é¢˜</p>
<pre><code>dial unix /var/run/docker.sock: permission denied.Are you trying to connect to a TLS-enabled
</code></pre>
<p>è§£å†³æ–¹æ³•ï¼š</p>
<p>æŠŠå½“å‰ç”¨æˆ·åŠ å…¥dockerç”¨æˆ·ç»„ã€‚</p>
<pre><code>  sudo gpasswd -a ${USER} docker
</code></pre>
<p>æŸ¥çœ‹æ˜¯å¦æ·»åŠ æˆåŠŸï¼š</p>
<pre><code>  cat /etc/group | grep ^docker
</code></pre>
<p>é‡å¯docker</p>
<pre><code>  sudo serivce docker restart
</code></pre>
<p>å¦‚æœé‡å¯åä¸æˆåŠŸï¼Œé€€å‡ºå½“å‰è´¦æˆ·é‡æ–°ç™»å½•ã€‚</p>
</li>
</ul>
]]></content>
    </entry>
</feed>